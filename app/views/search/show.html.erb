<div id="search">
  <div class="location-options">
    <form action="<%= search_path %>" method="get">
      <%= search_form_fields @search.query_params.except(:location, :latitude, :longitude) %>
      <%= label_tag 'location', "Location: " %>
      <%= text_field_tag 'location', params[:location] %>
      <%= submit_tag 'Change location', :name => nil %>
    </form>
  </div>

  <div class="search-container">
    <div class="search-content">

      <div class="query-options">
        <form action="<%= search_path %>" class="query" method="get">
          <%= search_form_fields @search.query_params.except(:query) %>
          <%= label_tag 'query', "Search for job title:" %>
          <%= text_field_tag 'query', params[:query] %>
          <%= submit_tag 'Search', :name => nil %>
        </form>

        <form action="<%= search_path %>" class="show-me-everything" method="get">
          <%= search_form_fields @search.query_params.except(:query) %>
          <%= submit_tag 'Show me all jobs', :name => nil %>
        </form>
      </div>

      <div class="permanent-options">
        <%- permanent_options.each do |k, v| -%>
          <form action="<%= search_path %>" method="get">
            <%= search_form_fields @search.query_params.except(:permanent) %>
            <%- unless v.nil? %>
              <%= hidden_field_tag 'permanent', v %>
            <%- end -%>
            <%= submit_tag k, :disabled => params[:permanent].to_s == v.to_s, :name => nil -%>
          </form>
        <%- end -%>
      </div>

      <div class="full-time-options">
        <%- time_options.each do |k, v| -%>
          <form action="<%= search_path %>" method="get">
            <%= search_form_fields @search.query_params.except(:full_time) %>
            <%- unless v.nil? %>
              <%= hidden_field_tag 'full_time', v %>
            <%- end -%>
            <%= submit_tag k, :disabled => params[:full_time].to_s == v.to_s, :name => nil -%>
          </form>
        <%- end -%>
      </div>

      <div class="recency-options">
        <%- recency_options.each do |k, v| -%>
          <form action="<%= search_path %>" method="get">
            <%= search_form_fields @search.query_params.except(:recency) %>
            <%- unless v.nil? %>
              <%= hidden_field_tag 'recency', v %>
            <%- end -%>
            <%= submit_tag k, :disabled => params[:recency].to_s == v.to_s, :name => nil -%>
          </form>
        <%- end -%>
      </div>

      <%- if @results.total > 0 -%>
        <p>Found <%= pluralize @results.total, 'result' %> within <%= pluralize @search.distance, 'mile' %>.</p>
        <table class="search-results">
          <thead>
            <tr>
              <th class="title">Title</th>
              <th>Location</th>
              <th>Details</th>
              <th>Date Posted</th>
              <th>&nbsp;</th>
            </tr>
          </thead>
          <tbody>
            <%- @results.docs.each do |doc| %>
              <%= content_tag :tr, :class => 'job', :data => { :id => doc['id'], :title => doc['title'] } do -%>
                <td class="title">
                  <span class="title"><%= link_to doc['title'].titlecase, job_path(doc['id']) %></span>
                  <br />
                  <span class="employer-name"><%= doc['employer_name'] %></span>
                </td>
                <td>
                  <%= doc['location_name'].titlecase %>
                  <br />
                  <%= distance(doc['location_0_coordinate'].to_f, doc['location_1_coordinate'].to_f, @search.latitude, @search.longitude).round(1) %> miles
                </td>
                <td>
                  Wage: <%= doc['wage_display_text'].presence.try(:titlecase) %>
                  <br />
                  Hours: <%= doc['hours_display_text'].presence.try(:titlecase) %>
                </td>
                <td><%= pretty_format_date(Time.iso8601(doc['received_on'])) if doc['received_on'].present? %></td>
                <td>
                  <a href="#" class="add-to-jobs-list">Add to List</a>
                  <br />
                  <a href="<%= job_path(doc['id']) %>">More info</a>
                </td>
              <%- end -%>
            <%- end -%>
          </tbody>
        </table>
        <%= pagination(@search, @results) %>
      <%- else -%>
        <p>No results found.</p>
      <%- end -%>
    </div>
  </div>
</div>